{% extends "base.html" %}

{% block title %}Admin Panel - Celebration Mosaic{% endblock %}

{% block content %}
<div class="container my-5">
    <div class="row">
        <div class="col-12">
            <h1 class="mb-4">‚öôÔ∏è Admin Panel</h1>
        </div>
    </div>

    <div class="row g-4">
        <!-- Logo Management -->
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h4 class="mb-0">üñºÔ∏è Logo Management</h4>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h5>Main Logo</h5>
                            <div class="mb-3">
                                <strong>Current Logo:</strong> {{ settings.logo_filename }}
                            </div>
                            <div class="mb-3">
                                <img src="{{ url_for('static', filename=settings.logo_filename) }}" 
                                     alt="Current Logo" class="img-thumbnail" style="max-width: 200px; max-height: 150px;">
                            </div>
                            <form method="POST" action="{{ url_for('upload_logo') }}" enctype="multipart/form-data">
                                <div class="mb-3">
                                    <label for="logo" class="form-label">Upload New Main Logo</label>
                                    <input type="file" class="form-control" id="logo" name="logo" 
                                           accept=".png,.jpg,.jpeg,.gif,.svg" required>
                                    <div class="form-text">For the mosaic background</div>
                                </div>
                                <input type="hidden" name="logo_type" value="main">
                                <button type="submit" class="btn btn-primary">üì§ Upload Main Logo</button>
                            </form>
                        </div>
                        <div class="col-md-6">
                            <h5>Short Logo</h5>
                            <div class="mb-3">
                                <strong>Current Short Logo:</strong> {{ settings.short_logo_filename }}
                            </div>
                            <div class="mb-3">
                                <img src="{{ url_for('static', filename=settings.short_logo_filename) }}" 
                                     alt="Current Short Logo" class="img-thumbnail" style="max-width: 200px; max-height: 150px;">
                            </div>
                            <form method="POST" action="{{ url_for('upload_logo') }}" enctype="multipart/form-data">
                                <div class="mb-3">
                                    <label for="short_logo" class="form-label">Upload New Short Logo</label>
                                    <input type="file" class="form-control" id="short_logo" name="logo" 
                                           accept=".png,.jpg,.jpeg,.gif,.svg" required>
                                    <div class="form-text">For the header display</div>
                                </div>
                                <input type="hidden" name="logo_type" value="short">
                                <button type="submit" class="btn btn-primary">üì§ Upload Short Logo</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings -->
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h4 class="mb-0">‚öôÔ∏è Display Settings</h4>
                </div>
                <div class="card-body">
                    <div class="mb-4">
                        <h5>üé® Color Scheme</h5>
                        <form method="POST" action="{{ url_for('upload_color_scheme') }}" enctype="multipart/form-data" class="mb-3">
                            <div class="mb-3">
                                <label for="color_scheme" class="form-label">Theme Colors</label>
                                <input type="file" class="form-control" id="color_scheme" name="color_scheme" 
                                       accept=".json" required>
                                <div class="form-text">
                                    Upload a color scheme file to customize the appearance.
                                    <button type="button" class="btn btn-link btn-sm p-0 ms-2" 
                                            data-bs-toggle="modal" data-bs-target="#colorSchemeHelpModal">
                                        View format guide
                                    </button>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary">
                                <i class="bi bi-palette"></i> Apply Color Scheme
                            </button>
                        </form>
                        
                        <div class="alert alert-info alert-sm d-flex align-items-center">
                            <i class="bi bi-info-circle me-2"></i>
                            Currently using: <strong class="ms-2">{{ "Custom Theme" if settings.color_scheme else "Default Theme" }}</strong>
                        </div>
                    </div>

                    <!-- Color Scheme Help Modal -->
                    <div class="modal fade" id="colorSchemeHelpModal" tabindex="-1">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title">Color Scheme Guide</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                </div>
                                <div class="modal-body">
                                    <h6 class="mb-3">Color Scheme Structure:</h6>
                                    <div class="mb-3">
                                        <strong>Submission Page</strong>
                                        <ul class="mb-3">
                                            <li>Page colors (background, text)</li>
                                            <li>Form elements (inputs, labels)</li>
                                            <li>Buttons and interactions</li>
                                            <li>Alert messages</li>
                                        </ul>
                                        
                                        <strong>Mosaic Page</strong>
                                        <ul>
                                            <li>Page colors</li>
                                            <li>Mosaic tile styling</li>
                                            <li>Grid layout elements</li>
                                        </ul>
                                    </div>
                                    <p class="text-muted small mb-0">
                                        All colors should be in hexadecimal format (e.g., #FF0000).
                                        Download a sample template for reference.
                                    </p>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <hr>
                    <form method="POST" action="{{ url_for('update_settings') }}">
                        <div class="mb-3">
                            <label for="header_text" class="form-label">Header Text</label>
                            <input type="text" class="form-control" id="header_text" name="header_text"
                                   value="{{ settings.header_text }}" maxlength="50">
                            <div class="form-text">Text displayed in the header on the left side</div>
                        </div>
                        <div class="mb-3">
                            <label for="max_entries" class="form-label">Maximum Entries to Display</label>
                            <input type="number" class="form-control" id="max_entries" name="max_entries" 
                                   value="{{ settings.max_entries }}" min="1" max="1000">
                            <div class="form-text">Oldest entries will be automatically removed</div>
                        </div>
                        <div class="mb-3">
                            <strong>Current Entry Count:</strong> 
                            <span class="badge bg-info">{{ entry_count }}</span>
                        </div>
                        
                        <hr>
                        
                        <div class="mb-3">
                            <label class="form-label">Mosaic Grid Settings</label>
                            <div class="mb-2">
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="grid_mode" id="grid_auto" 
                                           value="auto" {% if settings.grid_mode == 'auto' %}checked{% endif %}>
                                    <label class="form-check-label" for="grid_auto">
                                        Auto: Based on number of entries
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="grid_mode" id="grid_manual" 
                                           value="manual" {% if settings.grid_mode == 'manual' %}checked{% endif %}>
                                    <label class="form-check-label" for="grid_manual">
                                        Manual: Fixed grid size
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <div id="manualGridSettings" class="mb-3" style="display: {% if settings.grid_mode == 'manual' %}block{% else %}none{% endif %};">
                            <div class="row">
                                <div class="col-6">
                                    <label for="grid_rows" class="form-label">Rows</label>
                                    <input type="number" class="form-control" id="grid_rows" name="grid_rows" 
                                           value="{{ settings.grid_rows }}" min="1" max="50">
                                </div>
                                <div class="col-6">
                                    <label for="grid_cols" class="form-label">Columns</label>
                                    <input type="number" class="form-control" id="grid_cols" name="grid_cols" 
                                           value="{{ settings.grid_cols }}" min="1" max="50">
                                </div>
                            </div>
                            <div class="form-text">
                                Total tiles: <span id="totalTiles">{{ settings.grid_rows * settings.grid_cols }}</span>
                                <br>Empty tiles will be filled with background colors if there are fewer entries.
                            </div>
                        </div>
                        
                        <hr>
                        
                        <div class="mb-3">
                            <label class="form-label">üéâ Celebration Animations</label>
                            <div class="form-text mb-2">Select one or more animations that will be randomly chosen when celebrating new entries.</div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="celebration_animations[]" 
                                       value="confetti" id="anim_confetti" 
                                       {% if 'confetti' in settings.celebration_animations %}checked{% endif %}>
                                <label class="form-check-label" for="anim_confetti">
                                    Confetti Rain üéä
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="celebration_animations[]" 
                                       value="fireworks" id="anim_fireworks"
                                       {% if 'fireworks' in settings.celebration_animations %}checked{% endif %}>
                                <label class="form-check-label" for="anim_fireworks">
                                    Fireworks Display üéÜ
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="celebration_animations[]" 
                                       value="diwali" id="anim_diwali"
                                       {% if 'diwali' in settings.celebration_animations %}checked{% endif %}>
                                <label class="form-check-label" for="anim_diwali">
                                    Diwali Crackers ü™î
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="celebration_animations[]" 
                                       value="sparkle-rain" id="anim_sparkle"
                                       {% if 'sparkle-rain' in settings.celebration_animations %}checked{% endif %}>
                                <label class="form-check-label" for="anim_sparkle">
                                    Sparkling Rain ‚ú®
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="celebration_animations[]" 
                                       value="flower-burst" id="anim_flower"
                                       {% if 'flower-burst' in settings.celebration_animations %}checked{% endif %}>
                                <label class="form-check-label" for="anim_flower">
                                    Flower Burst üå∏
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="celebration_animations[]" 
                                       value="rangoli" id="anim_rangoli"
                                       {% if 'rangoli' in settings.celebration_animations %}checked{% endif %}>
                                <label class="form-check-label" for="anim_rangoli">
                                    Rangoli Pattern üé®
                                </label>
                            </div>
                        </div>
                        
                        <button type="submit" class="btn btn-primary">üíæ Save Settings</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Symbol Management -->
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h4 class="mb-0">üé≠ Celebratory Symbols</h4>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-8">
                            <h5>Current Symbols</h5>
                            <div class="row g-2 mb-4">
                                {% for symbol in settings.symbols %}
                                <div class="col-auto">
                                    <div class="card">
                                        <div class="card-body text-center p-3">
                                            <div class="mb-2">
                                                <img src="{{ url_for('static', filename='symbols/' + symbol.filename) }}" 
                                                     alt="{{ symbol.label }}" class="img-fluid" style="max-height: 50px;">
                                            </div>
                                            <div class="small">{{ symbol.label }}</div>
                                            <form method="POST" action="{{ url_for('remove_symbol') }}" class="mt-2">
                                                <input type="hidden" name="filename" value="{{ symbol.filename }}">
                                                <button type="submit" class="btn btn-sm btn-outline-danger"
                                                        onclick="return confirm('Remove this symbol?')">
                                                    üóëÔ∏è Remove
                                                </button>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                        <div class="col-md-4">
                            <h5>Add New Symbol</h5>
                            <form method="POST" action="{{ url_for('add_symbol') }}" enctype="multipart/form-data">
                                <div class="mb-3">
                                    <label for="symbol_file" class="form-label">Symbol Image (PNG)</label>
                                    <input type="file" class="form-control" id="symbol_file" name="symbol_file" 
                                           accept=".png" required>
                                </div>
                                <div class="mb-3">
                                    <label for="label" class="form-label">Label</label>
                                    <input type="text" class="form-control" id="label" name="label" 
                                           placeholder="e.g., Diya, Cracker" maxlength="50" required>
                                </div>
                                <button type="submit" class="btn btn-success">‚ûï Add Symbol</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Entry Management -->
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h4 class="mb-0">üìù Entry Management</h4>
                </div>
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <p class="mb-2">
                                <strong>Total Entries:</strong> 
                                <span class="badge bg-info fs-6">{{ entry_count }}</span>
                            </p>
                            <p class="mb-0 text-muted">
                                Manage all user submissions. Use with caution as this action cannot be undone.
                            </p>
                        </div>
                        <div class="col-md-4 text-end">
                            <form method="POST" action="{{ url_for('clear_entries') }}" class="d-inline">
                                <button type="submit" class="btn btn-danger"
                                        onclick="return confirm('Are you sure you want to clear ALL entries? This cannot be undone!')">
                                    üóëÔ∏è Clear All Entries
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Links -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card">
                <div class="card-body text-center">
                    <h5>Admin Controls</h5>
                    <button class="btn btn-outline-secondary" onclick="window.location.reload()">üîÑ Refresh Admin Panel</button>
                    <button class="btn btn-outline-info ms-2" onclick="showRouteInfo()">‚ÑπÔ∏è Route Information</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function showRouteInfo() {
    const currentUrl = window.location.href;
    const baseUrl = currentUrl.replace('/admin', '');
    
    alert(`Route Information:
    
üìù Submission Form: ${baseUrl}/
üé® Mosaic Display: ${baseUrl}/mosaic  
‚öôÔ∏è Admin Panel: ${baseUrl}/admin

Each route is designed to run on separate devices.
The mosaic automatically refreshes every 10 seconds.`);
}

// Grid settings toggle
document.addEventListener('DOMContentLoaded', function() {
    const autoRadio = document.getElementById('grid_auto');
    const manualRadio = document.getElementById('grid_manual');
    const manualSettings = document.getElementById('manualGridSettings');
    const rowsInput = document.getElementById('grid_rows');
    const colsInput = document.getElementById('grid_cols');
    const totalTilesSpan = document.getElementById('totalTiles');
    
    function toggleGridSettings() {
        if (manualRadio.checked) {
            manualSettings.style.display = 'block';
        } else {
            manualSettings.style.display = 'none';
        }
    }
    
    function updateTotalTiles() {
        const rows = parseInt(rowsInput.value) || 1;
        const cols = parseInt(colsInput.value) || 1;
        totalTilesSpan.textContent = rows * cols;
    }
    
    autoRadio.addEventListener('change', toggleGridSettings);
    manualRadio.addEventListener('change', toggleGridSettings);
    rowsInput.addEventListener('input', updateTotalTiles);
    colsInput.addEventListener('input', updateTotalTiles);
});
</script>
{% endblock %}
